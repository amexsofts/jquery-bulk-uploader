(function(a){window.UploaderConfig={max:4,placeHolder:"../images/placeholder",addButtonClass:"btn btn-sm btn-success uploader-add",addButtonText:'<i class="fa fa-plus"></i>',saveAllButtonClass:"btn btn-sm btn-primary",saveAllButtonText:'<i class="fa fa-save"></i>',removeAllButtonClass:"btn btn-sm btn-danger",removeAllButtonText:'<i class="fa fa-remove"></i>',saveButtonClass:"btn btn-sm btn-primary",saveButtonText:'<i class="fa fa-save"></i></a>',removeButtonClass:"btn btn-sm btn-danger",removeButtonText:'<i class="fa fa-remove"></i>',uploaderClass:"table table-striped table-condensed",commandRowClass:"",imageRowClass:"",imageContainerClass:"thumbnail",loadingImage:'<div class="uploader-loading"><i class="fa fa-spin fa-spinner fa-3x"></i></div>',imageClass:"img-responsive img-thumbnail",inputContainerClass:"input-group input-group-sm",textInputClass:"input-sm",numberInputClass:"input-sm",fileInputClass:"",longTextInputClass:"",set:function(b){},uploaders:[],done:function(g,b,e,f){if(typeof this.uploaders[g]!="undefined"&&typeof this.uploaders[g].tasks[b]!="undefined"){var d=this.uploaders[g].tasks[b];d.done(e,f)}}};a.fn.uploader=function(e){var b=a(this);var d=UploaderConfig;UploaderConfig.$element=b;var f={$element:b,$table:null,$commandRow:null,settings:e,tasks:[],rowCount:0,addToQueue:function(g){var h={$row:g};h.done=function(i,j){f.doneUploading(this.$row,i,j)};f.tasks.push(h);f.uploadImage(h)},uploadImage:function(h){var i=h.$row.find("td:first-child input[type=file]").prop("files");if(typeof FormData=="function"){var k=new FormData();k.append("upload",i[0]);k.append("uploader",0);k.append("task",f.rowCount-1);k.append("callback","window.UploaderConfig.done");k.append("ajax",true);if(f.settings.data){for(c in f.settings.data){k.append(c,f.settings.data[c])}}a.ajax({method:"POST",url:f.settings.imageUploadUrl,contentType:false,processData:false,data:k,success:function(m,l){a("body").append("<script>").children(":last-child").append(m).remove()}})}else{var j=f.createIframe(h.$row);var g=j.contents().find("body").append('<form method="post" enctype="multipart/form-data" ></form>').children(":last-child").attr("action",f.settings.imageUploadUrl);if(f.settings.data){for(c in f.settings.data){g.append('<input type="hidden" name="'+c+'" value="'+(f.settings.data[c])+'"/>')}}g.append('<input type="hidden" name="task" value="'+(f.rowCount-1)+'"/>').append('<input type="hidden" name="uploader" value="'+(0)+'"/>').append('<input type="hidden" name="callback" value="window.top.window.UploaderConfig.done"/>').append('<input type="file" name="upload"/>').children(":last-child").prop("files",i);g.submit()}},createIframe:function(g){return g.find("td:first-child").append('<div class="progress"></div>').children(":last-child").attr("id","progress_"+this.rowCount).end().append('<iframe src=""><html></html></iframe>').children(":last-child").attr("name","image_frame_"+this.rowCount).attr("id","image_frame_"+this.rowCount)},fileSelected:function(g){f.addToQueue(g)},cancelUpload:function(){},doneUploading:function(g,h,i){g.children(":first-child").children("*").remove().end().prepend("<div>").children(":first-child").addClass(d.imageContainerClass).append("<img>").children(":last-child").attr("src",h);g.find(".uploader-save").attr("disabled",false).click(function(){f.saveUpload(g,h,i)})},saveUpload:function(g,i,j){var h={};g.find(".uploader-input-container").each(function(){var k=a(this).find(".uploader-input").first();if(a.isFunction(k.data("uploader-value"))){h[k.attr("id")]=(k.data("uploader-value"))(k)}else{h[k.attr("id")]=k.data("uploader-value")}});if(f.settings.data){for(c in f.settings.data){h[c]=f.settings.data[c]}}h.imageUploadUrl=i;h.message=j;a.ajax({method:"POST",data:h,url:f.settings.saveUrl,success:function(k){g.addClass("bg-success")},error:function(k){g.addClass("bg-danger")}})},addRow:function(){var j=f.rowCount++;var i=f.$table.find(".uploader-command-row").after("<tr>").next("tr").attr("id","row_"+j);i.append("<td>").children(":last-child").append('<div class="loading">').children(":last-child").append(d.loadingImage).end().append('<input type="file" class="hide"/>').end().append("<td>").children(":last-child").append('<a href="javascript:;" class="uploader-save"></a> &nbsp;').children(":last-child").addClass(d.saveButtonClass).append(d.saveButtonText).attr("disabled",true).end().append('<a href="javascript:;" class="uploader-remove"></a>').children(":last-child").addClass(d.removeButtonClass).append(d.removeButtonText);if(f.settings.inputs){for(c in f.settings.inputs){var h=f.settings.inputs[c];var g=i.append("<td>").children(":last-child").append("<div>").children(":last-child").addClass(d.inputContainerClass).addClass("uploader-input-container");var k;switch(h.type){case"text":k=g.append("<label>"+h.label+"</label>").children(":last-child").append("<br/>").append('<input type="text"/>').children(":last-child").addClass("uploader-input").addClass(d.textInputClass);break;case"hidden":k=g.append("<label>"+h.label+"</label>").children(":last-child").append("<br/>").append('<input type="hidden"/>').children(":last-child").addClass("uploader-input").addClass(d.textInputClass);break;case"number":k=g.append("<label>"+h.label+"</label>").children(":last-child").append("<br/>").append('<input type="number"/>').children(":last-child").addClass("uploader-input").addClass(d.textInputClass);break;default:k=g.append("<label>"+h.label+"</label>").append(h.html).children(":last-child").addClass("uploader-input");break}if(h.value){k.data("uploader-value",h.value)}else{k.data("uploader-value",function(){return k.val()})}k.attr("id",h.name);k.attr("name",h.name);if(a.isFunction(h.callback)){h.callback(k)}}}i.find(".uploader-remove").click(this.removeRow);i.find("input[type=file]").change(function(){f.fileSelected(i)}).click();i.find(".save").click(function(){});return false},removeRow:function(){$newRow.remove();return false},construct:function(){var j=b.append("<table>").children(":last-child").addClass(d.uploaderClass).append("<tbody>").children(":last-child");this.$element=b;this.$table=j;var i=j.append("<tr>").children(":last-child");i.addClass(d.commandRowClass);i.addClass("uploader-command-row");this.$commandRow=i;i.append("<td>").children(":last-child").css({width:"200px"}).append('<a href="javascript:;" class="uploader-add">'+d.addButtonText+"</a> &nbsp;").children(":last-child").addClass(d.addButtonClass).end().append('<a href="javascript:;" class="uploader-save-all">'+d.saveAllButtonText+"</a> &nbsp;").children(":last-child").addClass(d.saveAllButtonClass).end().append('<a href="javascript:;" class="uploader-remove-all">'+d.removeAllButtonText+"</a> &nbsp;").children(":last-child").addClass(d.removeAllButtonClass).end();var l=i.find(".uploader-add");var k=i.find(".uploader-save-all");var h=i.find(".uploader-remove-all");var g=0;l.click(this.addRow);k.click(function(){j.find(".uploader-save").click()});UploaderConfig.uploaders.push(f)}};f.construct();return a(this)}}(jQuery));